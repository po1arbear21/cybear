module fukushima_m
  !! Fermi-Dirac integral for different orders (without Gamma-Function prefactor!!)

  implicit none

  private
  public fd1h, fdm1h, fdm3h, fdm5h, fdm7h, fdm9h, dfdm9h, ifd1h

contains

  real function fd1h(x)
    !! double precision rational minimax approximation of Fermi-Dirac integral of order k=1/2
    !! Reference: Fukushima, T. (2014, submitted to App. Math. Comp.)
    !! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>

    real x,ex,t,w,s,fd,factor
    parameter (factor=2.e0/3.e0)    ! = 1/(k+1)

    if(x.lt.-2.e0) then
      ex=exp(x)
      t=ex*7.38905609893065023e0
      fd=ex*(0.886226925452758014e0 &
      -ex*(19894.4553386951666e0 &
      +t*(4509.64329955948557e0 &
      +t*(303.461789035142376e0 &
      +t*(5.7574879114754736e0 &
      +t*0.00275088986849762610e0 &
      ))))/(63493.915041308052e0 &
      +t*(19070.1178243603945e0 &
      +t*(1962.19362141235102e0 &
      +t*(79.250704958640158e0 &
      +t)))))
    elseif(x.lt.0.e0) then
      s=-0.5e0*x
      t=1.e0-s
      fd=(149.462587768865243e0 &
      +t*(22.8125889885050154e0 &
      +t*(-0.629256395534285422e0 &
      +t*(9.08120441515995244e0 &
      +t*(3.35357478401835299e0 &
      +t*(-0.473677696915555805e0 &
      +t*(-0.467190913556185953e0 &
      +t*(-0.0880610317272330793e0 &
      -t*0.00262208080491572673e0 &
      ))))))))/(269.94660938022644e0 &
      +s*(343.6419926336247e0 &
      +s*(323.9049470901941e0 &
      +s*(218.89170769294024e0 &
      +s*(102.31331350098315e0 &
      +s*(36.319337289702664e0 &
      +s*(8.3317401231389461e0 &
      +s)))))))
    elseif(x.lt.2.e0) then
      t=0.5e0*x
      fd=(71652.717119215557e0 &
      +t*(134954.734070223743e0 &
      +t*(153693.833350315645e0 &
      +t*(123247.280745703400e0 &
      +t*(72886.293647930726e0 &
      +t*(32081.2499422362952e0 &
      +t*(10210.9967337762918e0 &
      +t*(2152.71110381320778e0 &
      +t*232.906588165205042e0 &
      ))))))))/(105667.839854298798e0 &
      +t*(31946.0752989314444e0 &
      +t*(71158.788776422211e0 &
      +t*(15650.8990138187414e0 &
      +t*(13521.8033657783433e0 &
      +t*(1646.98258283527892e0 &
      +t*(618.90691969249409e0 &
      +t*(-3.36319591755394735e0 &
      +t))))))))
    elseif(x.lt.5.e0) then
      t=0.3333333333333333333e0*(x-2.e0)
      fd=(23744.8706993314289e0 &
      +t*(68257.8589855623002e0 &
      +t*(89327.4467683334597e0 &
      +t*(62766.3415600442563e0 &
      +t*(20093.6622609901994e0 &
      +t*(-2213.89084119777949e0 &
      +t*(-3901.66057267577389e0 &
      -t*948.642895944858861e0 &
      )))))))/(9488.61972919565851e0 &
      +t*(12514.8125526953073e0 &
      +t*(9903.44088207450946e0 &
      +t*(2138.15420910334305e0 &
      +t*(-528.394863730838233e0 &
      +t*(-661.033633995449691e0 &
      +t*(-51.4481470250962337e0 &
      +t)))))))
    elseif(x.lt.10.e0) then
      t=0.2e0*x-1.e0
      fd=(311337.452661582536e0 &
      +t*(1.11267074416648198e6 &
      +t*(1.75638628895671735e6 &
      +t*(1.59630855803772449e6 &
      +t*(910818.935456183774e0 &
      +t*(326492.733550701245e0 &
      +t*(65507.2624972852908e0 &
      +t*4809.45649527286889e0 &
      )))))))/(39721.6641625089685e0 &
      +t*(86424.7529107662431e0 &
      +t*(88163.7255252151780e0 &
      +t*(50615.7363511157353e0 &
      +t*(17334.9774805008209e0 &
      +t*(2712.13170809042550e0 &
      +t*(82.2205828354629102e0 &
      -t)))))))*0.999999999999999877e0
    elseif(x.lt.20.e0) then
      t=0.1e0*x-1.e0
      fd=(7.26870063003059784e6 &
      +t*(2.79049734854776025e7 &
      +t*(4.42791767759742390e7 &
      +t*(3.63735017512363365e7 &
      +t*(1.55766342463679795e7 &
      +t*(2.97469357085299505e6 &
      +t*154516.447031598403e0 &
      ))))))/(340542.544360209743e0 &
      +t*(805021.468647620047e0 &
      +t*(759088.235455002605e0 &
      +t*(304686.671371640343e0 &
      +t*(39289.4061400542309e0 &
      +t*(582.426138126398363e0 &
      +t*(11.2728194581586028e0 &
      -t)))))))
    elseif(x.lt.40.e0) then
      t=0.05e0*x-1.e0
      fd=(4.81449797541963104e6 &
      +t*(1.85162850713127602e7 &
      +t*(2.77630967522574435e7 &
      +t*(2.03275937688070624e7 &
      +t*(7.41578871589369361e6 &
      +t*(1.21193113596189034e6 &
      +t*63211.9545144644852e0 &
      ))))))/(80492.7765975237449e0 &
      +t*(189328.678152654840e0 &
      +t*(151155.890651482570e0 &
      +t*(48146.3242253837259e0 &
      +t*(5407.08878394180588e0 &
      +t*(112.195044410775577e0 &
      -t))))))
    else
      w=1.e0/(x*x)
      s=1.e0-1600.e0*w
      fd=x*sqrt(x)*0.666666666666666667e0*(1.e0+w &
      *(8109.79390744477921e0 &
      +s*(342.069867454704106e0 &
      +s*1.07141702293504595e0)) &
      /(6569.98472532829094e0 &
      +s*(280.706465851683809e0 &
      +s)))
    endif
    fd1h=fd
    return
  end function

  real function fdm1h(x)
    !! double precision rational minimax approximation of Fermi-Dirac integral of order k=-1/2
    !! Reference: Fukushima, T. (2014, submitted to App. Math. Comp.)
    !! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>

    real x,ex,t,w,s,fd,factor
    parameter (factor=2.e0)    ! = 1/(k+1)

    if(x.lt.-2.e0) then
      ex=exp(x)
      t=ex*7.38905609893065023e0
      fd=ex*(1.77245385090551603e0 &
      -ex*(40641.4537510284430e0 &
      +t*(9395.7080940846442e0 &
      +t*(649.96168315267301e0 &
      +t*(12.7972295804758967e0 &
      +t*0.00153864350767585460e0 &
      ))))/(32427.1884765292940e0 &
      +t*(11079.9205661274782e0 &
      +t*(1322.96627001478859e0 &
      +t*(63.738361029333467e0 &
      +t)))))
    elseif(x.lt.0.e0) then
      s=-0.5e0*x
      t=1.e0-s
      fd=(272.770092131932696e0 &
      +t*(30.8845653844682850e0 &
      +t*(-6.43537632380366113e0 &
      +t*(14.8747473098217879e0 &
      +t*(4.86928862842142635e0 &
      +t*(-1.53265834550673654e0 &
      +t*(-1.02698898315597491e0 &
      +t*(-0.177686820928605932e0 &
      -t*0.00377141325509246441e0 &
      ))))))))/(293.075378187667857e0 &
      +s*(305.818162686270816e0 &
      +s*(299.962395449297620e0 &
      +s*(207.640834087494249e0 &
      +s*(92.0384803181851755e0 &
      +s*(37.0164914112791209e0 &
      +s*(7.88500950271420583e0 &
      +s)))))))
    elseif(x.lt.2.e0) then
      t=0.5e0*x
      fd=(3531.50360568243046e0 &
      +t*(6077.5339658420037e0 &
      +t*(6199.7700433981326e0 &
      +t*(4412.78701919567594e0 &
      +t*(2252.27343092810898e0 &
      +t*(811.84098649224085e0 &
      +t*(191.836401053637121e0 &
      +t*23.2881838959183802e0 &
      )))))))/(3293.83702584796268e0 &
      +t*(1528.97474029789098e0 &
      +t*(2568.48562814986046e0 &
      +t*(925.64264653555825e0 &
      +t*(574.23248354035988e0 &
      +t*(132.803859320667262e0 &
      +t*(29.8447166552102115e0 &
      +t)))))))
    elseif(x.lt.5.e0) then
      t=0.3333333333333333333e0*(x-2.e0)
      fd=(4060.70753404118265e0 &
      +t*(10812.7291333052766e0 &
      +t*(13897.5649482242583e0 &
      +t*(10628.4749852740029e0 &
      +t*(5107.70670190679021e0 &
      +t*(1540.84330126003381e0 &
      +t*(284.452720112970331e0 &
      +t*29.5214417358484151e0 &
      )))))))/(1564.58195612633534e0 &
      +t*(2825.75172277850406e0 &
      +t*(3189.16066169981562e0 &
      +t*(1955.03979069032571e0 &
      +t*(828.000333691814748e0 &
      +t*(181.498111089518376e0 &
      +t*(32.0352857794803750e0 &
      +t)))))))
    elseif(x.lt.10.e0) then
      t=0.2e0*x-1.e0
      fd=(1198.41719029557508e0 &
      +t*(3263.51454554908654e0 &
      +t*(3874.97588471376487e0 &
      +t*(2623.13060317199813e0 &
      +t*(1100.41355637121217e0 &
      +t*(267.469532490503605e0 &
      +t*(25.4207671812718340e0 &
      +t*0.389887754234555773e0 &
      )))))))/(273.407957792556998e0 &
      +t*(595.918318952058643e0 &
      +t*(605.202452261660849e0 &
      +t*(343.183302735619981e0 &
      +t*(122.187622015695729e0 &
      +t*(20.9016359079855933e0 &
      +t))))))
    elseif(x.lt.20.e0) then
      t=0.1e0*x-1.e0
      fd=(9446.00169435237637e0 &
      +t*(36843.4448474028632e0 &
      +t*(63710.1115419926191e0 &
      +t*(62985.2197361074768e0 &
      +t*(37634.5231395700921e0 &
      +t*(12810.9898627807754e0 &
      +t*(1981.56896138920963e0 &
      +t*81.4930171897667580e0 &
      )))))))/(1500.04697810133666e0 &
      +t*(5086.91381052794059e0 &
      +t*(7730.01593747621895e0 &
      +t*(6640.83376239360596e0 &
      +t*(3338.99590300826393e0 &
      +t*(860.499043886802984e0 &
      +t*(78.8565824186926692e0 &
      +t)))))))
    elseif(x.lt.40.e0) then
      t=0.05e0*x-1.e0
      fd=(22977.9657855367223e0 &
      +t*(123416.616813887781e0 &
      +t*(261153.765172355107e0 &
      +t*(274618.894514095795e0 &
      +t*(149710.718389924860e0 &
      +t*(40129.3371700184546e0 &
      +t*(4470.46495881415076e0 &
      +t*132.684346831002976e0 &
      )))))))/(2571.68842525335676e0 &
      +t*(12521.4982290775358e0 &
      +t*(23268.1574325055341e0 &
      +t*(20477.2320119758141e0 &
      +t*(8726.52577962268114e0 &
      +t*(1647.42896896769909e0 &
      +t*(106.475275142076623e0 &
      +t)))))))
    else
      w=1.e0/(x*x)
      t=1600.e0*w
      fd=sqrt(x)*factor*(1.e0 &
      -w*(0.411233516712009968e0 &
      +t*(0.00110980410034088951e0 &
      +t*(0.0000113689298990173683e0 &
      +t*(2.56931790679436797e-7 &
      +t*(9.97897786755446178e-9 &
      +t*8.67667698791108582e-10))))))
    endif
    fdm1h=fd
    return
  end function

  real function fdm3h(x)
    !! double precision rational minimax approximation of Fermi-Dirac integral of order k=-3/2
    !! Reference: Fukushima, T. (2014, submitted to App. Math. Comp.)
    !! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>

    real x,ex,t,w,s,fd,factor
    parameter (factor=-2.e0)    ! = 1/(k+1)

    if(x.lt.-2.e0) then
      ex=exp(x)
      t=ex*7.38905609893065023e0
      fd=ex*(-3.54490770181103205e0 &
      +ex*(82737.595643818605e0 &
      +t*(18481.5553495836940e0 &
      +t*(1272.73919064487495e0 &
      +t*(26.3420403338352574e0 &
      -t*0.00110648970639283347e0 &
      ))))/(16503.7625405383183e0 &
      +t*(6422.0552658801394e0 &
      +t*(890.85389683932154e0 &
      +t*(51.251447078851450e0 &
      +t)))))
    elseif(x.lt.0.e0) then
      s=-0.5e0*x
      t=1.e0-s
      fd=-(946.638483706348559e0 &
      +t*(76.3328330396778450e0 &
      +t*(62.7809183134124193e0 &
      +t*(83.8442376534073219e0 &
      +t*(23.2285755924515097e0 &
      +t*(3.21516808559640925e0 &
      +t*(1.58754232369392539e0 &
      +t*(0.687397326417193593e0 &
      +t*0.111510355441975495e0 &
      ))))))))/(889.4123665319664e0 &
      +s*(126.7054690302768e0 &
      +s*(881.4713137175090e0 &
      +s*(108.2557767973694e0 &
      +s*(289.38131234794585e0 &
      +s*(27.75902071820822e0 &
      +s*(34.252606975067480e0 &
      +s*(1.9592981990370705e0 &
      +s))))))))
    elseif(x.lt.2.e0) then
      t=0.5e0*x
      fd=-(754.61690882095729e0 &
      +t*(565.56180911009650e0 &
      +t*(494.901267018948095e0 &
      +t*(267.922900418996927e0 &
      +t*(110.418683240337860e0 &
      +t*(39.4050164908951420e0 &
      +t*(10.8654460206463482e0 &
      +t*(2.11194887477009033e0 &
      +t*0.246843599687496060e0 &
      ))))))))/(560.03894899770103e0 &
      +t*(70.007586553114572e0 &
      +t*(582.42052644718871e0 &
      +t*(56.181678606544951e0 &
      +t*(205.248662395572799e0 &
      +t*(12.5169006932790528e0 &
      +t*(27.2916998671096202e0 &
      +t*(0.53299717876883183e0 &
      +t))))))))
    elseif(x.lt.5.e0) then
      t=0.3333333333333333333e0*(x-2.e0)
      fd=-(526.022770226139287e0 &
      +t*(631.116211478274904e0 &
      +t*(516.367876532501329e0 &
      +t*(267.894697896892166e0 &
      +t*(91.3331816844847913e0 &
      +t*(17.5723541971644845e0 &
      +t*(1.46434478819185576e0 &
      +t*(1.29615441010250662e0 &
      +t*0.223495452221465265e0 &
      ))))))))/(354.867400305615304e0 &
      +t*(560.931137013002977e0 &
      +t*(666.070260050472570e0 &
      +t*(363.745894096653220e0 &
      +t*(172.272943258816724e0 &
      +t*(23.7751062504377332e0 &
      +t*(12.5916012142616255e0 &
      +t*(-0.888604976123420661e0 &
      +t))))))))
    elseif(x.lt.10.e0) then
      t=0.2e0*x-1.e0
      fd=-(18.0110784494455205e0 &
      +t*(36.1225408181257913e0 &
      +t*(38.4464752521373310e0 &
      +t*(24.1477896166966673e0 &
      +t*(9.27772356782901602e0 &
      +t*(2.49074754470533706e0 &
      +t*(0.163824586249464178e0 &
      -t*0.00329391807590771789e0 &
      )))))))/(18.8976860386360201e0 &
      +t*(49.3696375710309920e0 &
      +t*(60.9273314194720251e0 &
      +t*(43.6334649971575003e0 &
      +t*(20.6568810936423065e0 &
      +t*(6.11094689399482273e0 &
      +t))))))
    elseif(x.lt.20.e0) then
      t=0.1e0*x-1.e0
      fd=-(4.10698092142661427e0 &
      +t*(17.1412152818912658e0 &
      +t*(32.6347877674122945e0 &
      +t*(36.6653101837618939e0 &
      +t*(25.9424894559624544e0 &
      +t*(11.2179995003884922e0 &
      +t*(2.30099511642112478e0 &
      +t*(0.0928307248942099967e0 &
      -t*0.00146397877054988411e0 &
      ))))))))/(6.40341731836622598e0 &
      +t*(30.1333068545276116e0 &
      +t*(64.0494725642004179e0 &
      +t*(80.5635003792282196e0 &
      +t*(64.9297873014508805e0 &
      +t*(33.3013900893183129e0 &
      +t*(9.61549304470339929e0 &
      +t)))))))
    elseif(x.lt.40.e0) then
      t=0.05e0*x-1.e0
      fd=-(95.2141371910496454e0 &
      +t*(420.050572604265456e0 &
      +t*(797.778374374075796e0 &
      +t*(750.378359146985564e0 &
      +t*(324.818150247463736e0 &
      +t*(50.3115388695905757e0 &
      +t*(0.372431961605507103e0 &
      +t*(-0.103162211894757911e0 &
      +t*0.00191752611445211151e0 &
      ))))))))/(212.232981736099697e0 &
      +t*(1043.79079070035083e0 &
      +t*(2224.50099218470684e0 &
      +t*(2464.84669868672670e0 &
      +t*(1392.55318009810070e0 &
      +t*(346.597189642259199e0 &
      +t*(22.7314613168652593e0 &
      -t)))))))
    else
      w=1.e0/(x*x)
      s=1.e0-1600.e0*w
      fd=factor/sqrt(x)*(1.e0 &
      +w*(12264.3569103180524e0 &
      +s*(3204.34872454052352e0 &
      +s*(140.119604748253961e0 &
      +s*0.523918919699235590e0 &
      )))/(9877.87829948067200e0 &
      +s*(2644.71979353906092e0 &
      +s*(128.863768007644572e0 &
      +s))))
    endif
    fdm3h=fd
    return
  end function

  real function fdm5h(x)
    !! double precision rational minimax approximation of Fermi-Dirac integral of order k=-5/2
    !! Reference: Fukushima, T. (2014, submitted to App. Math. Comp.)
    !! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>

    real x,ex,t,w,s,fd,factor
    parameter (factor=-2.e0/3.e0)    ! = 1/(k+1)

    if(x.lt.-2.e0) then
      ex=exp(x)
      t=ex*7.38905609893065023e0
      fd=ex*(2.36327180120735470e0 &
      -ex*(55891.891151428516e0 &
      +t*(10900.4507673238614e0 &
      +t*(731.61871282829311e0 &
      +t*(17.3576202287841595e0 &
      +t*0.00111269690244199535e0 &
      ))))/(8361.6144419623308e0 &
      +t*(3709.66537451151168e0 &
      +t*(598.60597628606205e0 &
      +t*(41.1772384480908825e0 &
      +t)))))
    elseif(x.lt.0.e0) then
      s=-0.5e0*x
      fd=(46.7273884990861909e0 &
      +s*(65.1460094720913271e0 &
      +s*(-23.3560330148569366e0 &
      +s*(16.3832748811699383e0 &
      +s*(-6.19159773777140396e0 &
      +s*(0.799041627235852088e0 &
      +s*(-0.136702158227027886e0 &
      +s*(0.0592594484852497570e0 &
      -s*0.00813537888028213710e0 &
      ))))))))/(166.600811683081505e0 &
      +s*(-14.3475443594245037e0 &
      +s*(207.623210767457661e0 &
      +s*(-16.0651771000195284e0 &
      +s*(91.9265825199149767e0 &
      +s*(-5.91543082309762067e0 &
      +s*(16.6946542439476255e0 &
      +s*(-0.714551880206870314e0 &
      +s))))))))
    elseif(x.lt.2.e0) then
      t=0.5e0*x
      fd=-(55.096201117757232e0 &
      +t*(14.3294333176185961e0 &
      +t*(8.7057675255700556e0 &
      +t*(2.85717540287481278e0 &
      +t*(0.153440611811510950e0 &
      +t*(0.111339313377987928e0 &
      +t*(0.052394928476702755e0 &
      -t*0.00308189450941126788e0 &
      )))))))/(217.840649625384406e0 &
      +t*(-13.7539547994891024e0 &
      +t*(264.475360271691825e0 &
      +t*(-16.3936568402444332e0 &
      +t*(112.575929318729487e0 &
      +t*(-6.5735021347402422e0 &
      +t*(19.1324946771515682e0 &
      +t*(-0.89572129073702419e0 &
      +t))))))))*(x-1.10894923342229868e0)  ! care for zero point
    elseif(x.lt.5.e0) then
      t=0.3333333333333333333e0*(x-2.e0)
      fd=-(4.91753613607304828e0 &
      +t*(20.4599278677959969e0 &
      +t*(14.7299603843029675e0 &
      +t*(6.07034924563989291e0 &
      +t*(2.84749597355562421e0 &
      +t*(1.42067667370006629e0 &
      +t*(0.194025010869198784e0 &
      +t*(0.0296942990922311325e0 &
      +t*0.0000687311336894144097e0 &
      ))))))))/(39.1942895728295075e0 &
      +t*(102.720679402185990e0 &
      +t*(163.814228574815100e0 &
      +t*(160.042363559709804e0 &
      +t*(112.736106158227044e0 &
      +t*(53.5881251269350506e0 &
      +t*(19.3013585080264391e0 &
      +t*(4.60099930165203599e0 &
      +t))))))))
    elseif(x.lt.10.e0) then
      t=0.2e0*x-1.e0
      fd=-(2.27928384600199307e0 &
      +t*(4.20924981693908136e0 &
      +t*(3.71772880855517432e0 &
      +t*(3.45602273475008183e0 &
      +t*(1.35886950179549082e0 &
      +t*(0.536408369715153184e0 &
      +t*(0.133773439887674841e0 &
      +t*(0.0125358162552656152e0 &
      -t*0.000258659892241001720e0 &
      ))))))))/(29.5538409791709387e0 &
      +t*(102.889070328418668e0 &
      +t*(171.483234327128671e0 &
      +t*(174.069526985568413e0 &
      +t*(121.638517061339171e0 &
      +t*(61.2471517251153565e0 &
      +t*(22.6513730231817499e0 &
      +t*(5.63585485331701445e0 &
      +t))))))))
    elseif(x.lt.20.e0) then
      t=0.1e0*x-1.e0
      fd=-(0.138865047109769882e0 &
      +t*(0.495879942014454703e0 &
      +t*(0.975841030964797014e0 &
      +t*(1.19756546203286062e0 &
      +t*(1.04262591465861665e0 &
      +t*(0.636815947333856586e0 &
      +t*(0.267431185397286764e0 &
      +t*(0.0680541575349993884e0 &
      +t*(0.00339987875007404643e0 &
      -t*0.0000596473600392971721e0 &
      )))))))))/(6.10307238045677639e0 &
      +t*(32.0683844393622288e0 &
      +t*(81.7709446404731603e0 &
      +t*(131.907213444156949e0 &
      +t*(148.807381678792024e0 &
      +t*(122.126271732385001e0 &
      +t*(73.4713378422568434e0 &
      +t*(31.3211204388750577e0 &
      +t*(8.63324324695581677e0 &
      +t)))))))))
    elseif(x.lt.40.e0) then
      t=0.05e0*x-1.e0
      fd=-(0.294313222065093082e0 &
      +t*(1.31885924825320721e0 &
      +t*(2.84488318326892294e0 &
      +t*(3.47529649317584998e0 &
      +t*(2.44599317338319296e0 &
      +t*(0.711594188260176831e0 &
      +t*(0.0568475228400688404e0 &
      +t*(0.000310240841471278615e0 &
      +t*7.25941094961112814e-6 &
      ))))))))/(38.8567648628867585e0 &
      +t*(233.714122704911173e0 &
      +t*(657.094399788013655e0 &
      +t*(1097.58958431940912e0 &
      +t*(1157.52830939122072e0 &
      +t*(742.054932624983009e0 &
      +t*(251.716945386093114e0 &
      +t*(34.4183681886106367e0 &
      +t))))))))
    else
      w=1.e0/(x*x)
      s=1.e0-1600.e0*w
      fd=factor/(sqrt(x)*x)*(1.e0 &
      +w*(563249.531577994933e0 &
      +s*(348717.634501234702e0 &
      +s*(40765.2886083808789e0 &
      +s*865.059113888543852e0 &
      )))/(90262.6676538587293e0 &
      +s*(56944.6907876652433e0 &
      +s*(7175.67113380361324e0 &
      +s*(207.376531486457753e0 &
      +s)))))
    endif
    fdm5h=fd
    return
  end function

  real function fdm7h(x)
    !! double precision rational minimax approximation of Fermi-Dirac integral of order k=-7/2
    !! Reference: Fukushima, T. (2014, submitted to App. Math. Comp.)
    !! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>

    real x,ex,t,w,s,fd,factor
    parameter (factor=-2.e0/5.e0)    ! = 1/(k+1)

    if(x.lt.-2.e0) then
      ex=exp(x)
      t=ex*7.38905609893065023e0
      fd=ex*(-0.945308720482941881e0 &
      +ex*(22521.6817696480830e0 &
      +t*(3006.50943115266211e0 &
      +t*(223.777970320362539e0 &
      +t*(7.1096231598119406e0 &
      -t*0.00186000064211079826e0 &
      ))))/(4211.64894546505314e0 &
      +t*(2132.92301652550982e0 &
      +t*(400.935813755588393e0 &
      +t*(33.0304914363496116e0 &
      +t)))))
    elseif(x.lt.0.e0) then
      s=-0.5e0*x
      fd=(5.49736264373955718e0 &
      +s*(3.93868182790099018e0 &
      +s*(0.00680535603918657089e0 &
      +s*(-0.0610218211998865281e0 &
      +s*(-0.195616572333524455e0 &
      +s*(0.0172573301744899007e0 &
      +s*(0.0148839062617757320e0 &
      +s*(-0.00259857880173559174e0 &
      +s*0.0000170523346905109458e0 &
      ))))))))/(48.4238197836838959e0 &
      +s*(8.18206322265668686e0 &
      +s*(73.9370055146725832e0 &
      +s*(10.7170918787834126e0 &
      +s*(42.0907078084017798e0 &
      +s*(4.72976153773643018e0 &
      +s*(10.5965223842451046e0 &
      +s*(0.704336166377684061e0 &
      +s))))))))*(x+0.731435761340666539e0) ! care for zero point
    elseif(x.lt.2.e0) then
      t=0.5e0*x
      fd=(143.837264704139569e0 &
      +t*(322.683997310438763e0 &
      +t*(-209.374575032955500e0 &
      +t*(-54.681932464048843e0 &
      +t*(-30.3617985514093593e0 &
      +t*(-5.7605448223972412e0 &
      +t*(3.65745825030136209e0 &
      +t*(0.145440718467921945e0 &
      +t*(-0.340001125998911237e0 &
      +t*0.0446577756904410773e0 &
      )))))))))/(1732.20737492411446e0 &
      +t*(97.952930820143076e0 &
      +t*(2660.50150777614871e0 &
      +t*(115.730278615026183e0 &
      +t*(1524.22026694958607e0 &
      +t*(40.4116469657132500e0 &
      +t*(385.907052068138736e0 &
      +t*(1.45068964456455148e0 &
      +t*(36.4544527882983039e0 &
      -t)))))))))
    elseif(x.lt.5.e0) then
      t=0.3333333333333333333e0*(x-2.e0)
      fd=-(66.1873851488861175e0 &
      +t*(57.9197865216898287e0 &
      +t*(-10.6658833177171402e0 &
      +t*(10.2066946495410176e0 &
      +t*(1.19595124198914370e0 &
      +t*(-1.81286879962085966e0 &
      +t*(1.52800227451442796e0 &
      +t*(-0.546498161708704000e0 &
      +t*(0.0988077919447287808e0 &
      -t*0.00745279173673929794e0 &
      )))))))))/(1525.13818882033488e0 &
      +t*(3966.07893650424194e0 &
      +t*(6837.27734004268945e0 &
      +t*(7086.45653543153192e0 &
      +t*(5612.71274301484627e0 &
      +t*(2928.56588821761611e0 &
      +t*(1256.17847516062581e0 &
      +t*(310.558929999645079e0 &
      +t*(89.3091775022809646e0 &
      -t)))))))))*(x-2.59355543171509487e0) ! care for zero point
    elseif(x.lt.10.e0) then
      t=0.2e0*x-1.e0
      fd=-(0.184179377827614791e0 &
      +t*(0.516542442597467614e0 &
      +t*(0.292799259677321999e0 &
      +t*(0.166303092691678597e0 &
      +t*(0.258615034442190300e0 &
      +t*(-0.0303157249245734253e0 &
      +t*(0.0373447714795897992e0 &
      +t*(-0.00332926057033243781e0 &
      +t*(0.000563408857595472728e0 &
      -t*0.0000334037183021934960e0 &
      )))))))))/(18.2615126816087432e0 &
      +t*(85.1686926876657081e0 &
      +t*(181.378990080239764e0 &
      +t*(232.528454347497368e0 &
      +t*(200.564064511137621e0 &
      +t*(125.206874911765040e0 &
      +t*(58.6883968744415564e0 &
      +t*(20.6768210567814309e0 &
      +t*(5.02620698086580395e0 &
      +t)))))))))
    elseif(x.lt.20.e0) then
      t=0.1e0*x-1.e0
      fd=-(0.00521027824483942692e0 &
      +t*(0.0159223834333424812e0 &
      +t*(0.0290786393625134859e0 &
      +t*(0.0350554456604475612e0 &
      +t*(0.0276022017688728517e0 &
      +t*(0.0190056432579866130e0 &
      +t*(0.00725681379911524042e0 &
      +t*(0.00278845414163336780e0 &
      +t*(0.000285395695659601419e0 &
      +t*(-9.95541819385254380e-6 &
      +t*2.96666654254966665e-7 &
      ))))))))))/(3.40047012308625195e0 &
      +t*(20.3896764592442369e0 &
      +t*(58.0983301256082527e0 &
      +t*(104.466101980605120e0 &
      +t*(132.574327309248600e0 &
      +t*(125.279491711147983e0 &
      +t*(90.3637198347191251e0 &
      +t*(49.8942487159252830e0 &
      +t*(20.6309250519127594e0 &
      +t*(5.96507377885482873e0 &
      +t))))))))))
    elseif(x.lt.40.e0) then
      t=0.05e0*x-1.e0
      fd=-(0.000222755850099679261e0 &
      +t*(0.00115329637370955141e0 &
      +t*(0.00290802444182764526e0 &
      +t*(0.00445062601336644735e0 &
      +t*(0.00436605816073874863e0 &
      +t*(0.00260703930450196953e0 &
      +t*(0.000708204675930321953e0 &
      +t*(0.0000387281377930932522e0 &
      +t*(-1.07635110532534644e-6 &
      +t*3.45876932703497152e-8 &
      )))))))))/(0.958823449511661332e0 &
      +t*(7.43981964725756497e0 &
      +t*(27.2010614567095770e0 &
      +t*(61.4593095996041459e0 &
      +t*(94.2239246717949674e0 &
      +t*(100.959076669111257e0 &
      +t*(74.4305466149867624e0 &
      +t*(35.3635458846636560e0 &
      +t*(9.43423871492993288e0 &
      +t)))))))))
    else
      w=1.e0/(x*x)
      s=1.e0-1600.e0*w
      fd=factor/(sqrt(x)*x*x)*(1.e0 &
      +w*(114389.966467649306e0 &
      +s*(109888.157408212290e0 &
      +s*(21209.9082486576965e0 &
      +s*(896.625771647944984e0 &
      +s*2.27005555539139462e0 &
      ))))/(7803.86522209355981e0 &
      +s*(7642.62657004470466e0 &
      +s*(1584.72834559231955e0 &
      +s*(86.0988387732258338e0 &
      +s)))))
    endif
    fdm7h=fd
    return
  end function

  real function fdm9h(x)
    !! double precision rational minimax approximation of Fermi-Dirac integral of order k=-9/2
    !! Reference: Fukushima, T. (2014, submitted to App. Math. Comp.)
    !! Author: Fukushima, T. <Toshio.Fukushima@nao.ac.jp>

    real x,ex,t,w,s,fd,factor
    parameter (factor=-2.e0/7.e0)    ! = 1/(k+1)

    if(x.lt.-2.e0) then
      ex=exp(x)
      t=ex*7.38905609893065023e0
      fd=ex*(0.270088205852269109e0 &
      -ex*(98457.373700674016e0 &
      +t*(7895.1716828987114e0 &
      +t*(1170.39154599810719e0 &
      +t*(84.347808600628057e0 &
      +t*(1.94779771326323869e0 &
      +t*0.00062804476066590963e0 &
      )))))/(32220.8981607867840e0 &
      +t*(20608.4545396913128e0 &
      +t*(5234.8569367171782e0 &
      +t*(658.75071261067250e0 &
      +t*(40.9380138615149699e0 &
      +t))))))
    elseif(x.lt.0.e0) then
      s=-0.5e0*x
      fd=(-1.8432713155273516e0 &
      +s*(-7.2420131297087391e0 &
      +s*(-2.2155513134917048e0 &
      +s*(0.04304761419364448e0 &
      +s*(-0.16668060134499780e0 &
      +s*(0.10403025949642735e0 &
      +s*(0.016505424797869711e0 &
      +s*(-0.0063406328104926592e0 &
      +s*(-0.0009078668865214013e0 &
      +s*0.00024692958093140298e0 &
      )))))))))/(129.8291336259148e0 &
      +s*(-1.9134679779378e0 &
      +s*(249.6123960853833e0 &
      +s*(-3.3454980273582e0 &
      +s*(190.7566926415911e0 &
      +s*(-2.2190711173347e0 &
      +s*(72.29929273955658e0 &
      +s*(-0.66382343556531e0 &
      +s*(13.551723146833901e0 &
      +s*(-0.0757657170023758e0 &
      +s))))))))))*(x+1.82715356570827096e0)  ! care for zero point
    elseif(x.lt.2.e0) then
      t=0.5e0*x
      fd=(27.9376225634323064e0 &
      +t*(17.6954702922794847e0 &
      +t*(-18.2160790482833106e0 &
      +t*(-2.57045608672749918e0 &
      +t*(2.20866272949862340e0 &
      +t*(-0.104202929779896185e0 &
      +t*(-0.177712759450918142e0 &
      +t*(0.055743070525419128e0 &
      -t*0.0059642251814009821e0 &
      ))))))))/(599.97601432112870e0 &
      +t*(-64.538219224509587e0 &
      +t*(1048.07497435809354e0 &
      +t*(-104.535376308139931e0 &
      +t*(694.31701140352634e0 &
      +t*(-61.402988847817226e0 &
      +t*(207.271703307329581e0 &
      +t*(-14.7241003912299059e0 &
      +t*(23.5639226214135345e0 &
      -t)))))))))*(x-0.557104412737456300e0)  ! care for zero point
    elseif(x.lt.5.e0) then
      t=0.3333333333333333333e0*(x-2.e0)
      fd=-(0.105736863491337914e0 &
      +t*(0.182686468618144972e0 &
      +t*(-0.0830333880807117100e0 &
      +t*(0.0123471104343183151e0 &
      +t*(0.0213438566082710205e0 &
      +t*(-0.0431206240183745280e0 &
      +t*(0.0311190249582737067e0 &
      +t*(-0.0115670162945002128e0 &
      +t*(0.00222720333535487902e0 &
      -t*0.000179769912955733772e0 &
      )))))))))/(11.4369029896970731e0 &
      +t*(29.5790675947434036e0 &
      +t*(55.2958932613908644e0 &
      +t*(59.7192644653455683e0 &
      +t*(51.8646589384828875e0 &
      +t*(26.5061101661226671e0 &
      +t*(11.1515306816966566e0 &
      +t*(-0.140562900980389991e0 &
      +t*(-0.566848363630388431e0 &
      -t)))))))))*(x-3.79898975457237574e0) ! care for zero point
    elseif(x.lt.10.e0) then
      t=0.2e0*x-1.e0
      fd=-(0.0131615741211877996e0 &
      +t*(0.0630819955070757629e0 &
      +t*(0.0347025335431948214e0 &
      +t*(0.00659613983600166143e0 &
      +t*(0.0239129779624141424e0 &
      +t*(0.000528952248906432005e0 &
      +t*(0.00411353218448862483e0 &
      +t*(-0.00119448333536781374e0 &
      +t*(0.000497581590580634773e0 &
      +t*(-0.0000934288845342437109e0 &
      +t*7.29489294899966855e-6 &
      ))))))))))/(12.2828253912160684e0 &
      +t*(63.2143680817101004e0 &
      +t*(155.880993448869246e0 &
      +t*(239.067686638304706e0 &
      +t*(254.656949674257383e0 &
      +t*(200.134181826630681e0 &
      +t*(120.784221710133443e0 &
      +t*(56.5037249583191013e0 &
      +t*(20.2196452284175417e0 &
      +t*(5.22412387722958575e0 &
      +t))))))))))
    elseif(x.lt.20.e0) then
      t=0.1e0*x-1.e0
      fd=-(0.000243271785585373458e0 &
      +t*(0.000534699823019827761e0 &
      +t*(0.000824373965146324914e0 &
      +t*(0.00106321349769688454e0 &
      +t*(0.000488890808530810197e0 &
      +t*(0.000510404811590977338e0 &
      +t*(0.0000543711407291589868e0 &
      +t*(0.0000597066095966549458e0 &
      +t*(-9.52409541937957252e-6 &
      +t*(1.26499979908255436e-6 &
      -t*8.23879904655758674e-8 &
      ))))))))))/(1.89001039755418574e0 &
      +t*(12.0291520111708943e0 &
      +t*(36.3016148236874403e0 &
      +t*(69.0194326307265861e0 &
      +t*(92.5327210822279397e0 &
      +t*(92.3443444983825834e0 &
      +t*(70.3437819943334403e0 &
      +t*(41.0546070181362401e0 &
      +t*(17.9813587502434782e0 &
      +t*(5.52467389311001165e0 &
      +t))))))))))
    elseif(x.lt.40.e0) then
      t=0.05e0*x-1.e0
      fd=-(5.76414987722574846e-6 &
      +t*(0.0000175838621123388022e0 &
      +t*(0.0000306497936833891724e0 &
      +t*(0.0000245465851262614617e0 &
      +t*(9.68986921084327441e-6 &
      +t*(-9.60429091051474115e-6 &
      +t*(-2.71258276002580026e-6 &
      +t*(2.14306002093744082e-7 &
      +t*(-2.02878733208210684e-8 &
      +t*1.11972866705178940e-9 &
      )))))))))/(0.672666709110930353e0 &
      +t*(4.51114986457223474e0 &
      +t*(14.2130577502093159e0 &
      +t*(27.0924755033205922e0 &
      +t*(33.3161322251216687e0 &
      +t*(25.3582658290231325e0 &
      +t*(8.61719049364763904e0 &
      +t*(-2.98613950390747585e0 &
      +t*(-3.72974082078125757e0 &
      -t)))))))))
    else
      w=1.e0/(x*x)
      s=1.e0-1600.e0*w
      fd=factor/(sqrt(x)*x*x*x)*(1.e0 &
      +w*(20360.4093941608469e0 &
      +s*(48690.0157659639679e0 &
      +s*(56148.8553220593957e0 &
      +s*(16506.5714937251887e0 &
      +s*(1066.30280063583769e0 &
      +s*3.73715435019239458e0 &
      )))))/(765.319028032818290e0 &
      +s*(1851.12566867527470e0 &
      +s*(2160.21729234460541e0 &
      +s*(677.261952266814024e0 &
      +s*(56.0179124057448609e0 &
      +s))))))
    endif
    fdm9h=fd
    return
  end function

  real function dfdm9h(x)
    !! derivative of fdm9h using complex step derivative
    real, intent(in) :: x

    real, parameter :: h = 1e-32, factor = - 2.0 / 7.0
    complex         :: xx, ex, t, w, s, fd

    xx = cmplx(x, h)

    if (x < -2) then
      ex = exp(xx)
      t=ex*7.38905609893065023e0
      fd=ex*(0.270088205852269109e0 &
      -ex*(98457.373700674016e0 &
      +t*(7895.1716828987114e0 &
      +t*(1170.39154599810719e0 &
      +t*(84.347808600628057e0 &
      +t*(1.94779771326323869e0 &
      +t*0.00062804476066590963e0 &
      )))))/(32220.8981607867840e0 &
      +t*(20608.4545396913128e0 &
      +t*(5234.8569367171782e0 &
      +t*(658.75071261067250e0 &
      +t*(40.9380138615149699e0 &
      +t))))))
    elseif(x < 0) then
      s  = -0.5 * xx
      fd=(-1.8432713155273516e0 &
      +s*(-7.2420131297087391e0 &
      +s*(-2.2155513134917048e0 &
      +s*(0.04304761419364448e0 &
      +s*(-0.16668060134499780e0 &
      +s*(0.10403025949642735e0 &
      +s*(0.016505424797869711e0 &
      +s*(-0.0063406328104926592e0 &
      +s*(-0.0009078668865214013e0 &
      +s*0.00024692958093140298e0 &
      )))))))))/(129.8291336259148e0 &
      +s*(-1.9134679779378e0 &
      +s*(249.6123960853833e0 &
      +s*(-3.3454980273582e0 &
      +s*(190.7566926415911e0 &
      +s*(-2.2190711173347e0 &
      +s*(72.29929273955658e0 &
      +s*(-0.66382343556531e0 &
      +s*(13.551723146833901e0 &
      +s*(-0.0757657170023758e0 &
      +s))))))))))*(xx+1.82715356570827096e0)  ! care for zero point
    elseif(x.lt.2.e0) then
      t = 0.5 * xx
      fd=(27.9376225634323064e0 &
      +t*(17.6954702922794847e0 &
      +t*(-18.2160790482833106e0 &
      +t*(-2.57045608672749918e0 &
      +t*(2.20866272949862340e0 &
      +t*(-0.104202929779896185e0 &
      +t*(-0.177712759450918142e0 &
      +t*(0.055743070525419128e0 &
      -t*0.0059642251814009821e0 &
      ))))))))/(599.97601432112870e0 &
      +t*(-64.538219224509587e0 &
      +t*(1048.07497435809354e0 &
      +t*(-104.535376308139931e0 &
      +t*(694.31701140352634e0 &
      +t*(-61.402988847817226e0 &
      +t*(207.271703307329581e0 &
      +t*(-14.7241003912299059e0 &
      +t*(23.5639226214135345e0 &
      -t)))))))))*(xx-0.557104412737456300e0)  ! care for zero point
    elseif(x < 5) then
      t = 0.3333333333333333333 * (xx - 2)
      fd=-(0.105736863491337914e0 &
      +t*(0.182686468618144972e0 &
      +t*(-0.0830333880807117100e0 &
      +t*(0.0123471104343183151e0 &
      +t*(0.0213438566082710205e0 &
      +t*(-0.0431206240183745280e0 &
      +t*(0.0311190249582737067e0 &
      +t*(-0.0115670162945002128e0 &
      +t*(0.00222720333535487902e0 &
      -t*0.000179769912955733772e0 &
      )))))))))/(11.4369029896970731e0 &
      +t*(29.5790675947434036e0 &
      +t*(55.2958932613908644e0 &
      +t*(59.7192644653455683e0 &
      +t*(51.8646589384828875e0 &
      +t*(26.5061101661226671e0 &
      +t*(11.1515306816966566e0 &
      +t*(-0.140562900980389991e0 &
      +t*(-0.566848363630388431e0 &
      -t)))))))))*(xx-3.79898975457237574e0) ! care for zero point
    elseif(x < 10) then
      t = 0.2 * xx - 1
      fd=-(0.0131615741211877996e0 &
      +t*(0.0630819955070757629e0 &
      +t*(0.0347025335431948214e0 &
      +t*(0.00659613983600166143e0 &
      +t*(0.0239129779624141424e0 &
      +t*(0.000528952248906432005e0 &
      +t*(0.00411353218448862483e0 &
      +t*(-0.00119448333536781374e0 &
      +t*(0.000497581590580634773e0 &
      +t*(-0.0000934288845342437109e0 &
      +t*7.29489294899966855e-6 &
      ))))))))))/(12.2828253912160684e0 &
      +t*(63.2143680817101004e0 &
      +t*(155.880993448869246e0 &
      +t*(239.067686638304706e0 &
      +t*(254.656949674257383e0 &
      +t*(200.134181826630681e0 &
      +t*(120.784221710133443e0 &
      +t*(56.5037249583191013e0 &
      +t*(20.2196452284175417e0 &
      +t*(5.22412387722958575e0 &
      +t))))))))))
    elseif(x < 20) then
      t = 0.1 * xx - 1
      fd=-(0.000243271785585373458e0 &
      +t*(0.000534699823019827761e0 &
      +t*(0.000824373965146324914e0 &
      +t*(0.00106321349769688454e0 &
      +t*(0.000488890808530810197e0 &
      +t*(0.000510404811590977338e0 &
      +t*(0.0000543711407291589868e0 &
      +t*(0.0000597066095966549458e0 &
      +t*(-9.52409541937957252e-6 &
      +t*(1.26499979908255436e-6 &
      -t*8.23879904655758674e-8 &
      ))))))))))/(1.89001039755418574e0 &
      +t*(12.0291520111708943e0 &
      +t*(36.3016148236874403e0 &
      +t*(69.0194326307265861e0 &
      +t*(92.5327210822279397e0 &
      +t*(92.3443444983825834e0 &
      +t*(70.3437819943334403e0 &
      +t*(41.0546070181362401e0 &
      +t*(17.9813587502434782e0 &
      +t*(5.52467389311001165e0 &
      +t))))))))))
    elseif(x < 40) then
      t = 0.05 * xx - 1
      fd=-(5.76414987722574846e-6 &
      +t*(0.0000175838621123388022e0 &
      +t*(0.0000306497936833891724e0 &
      +t*(0.0000245465851262614617e0 &
      +t*(9.68986921084327441e-6 &
      +t*(-9.60429091051474115e-6 &
      +t*(-2.71258276002580026e-6 &
      +t*(2.14306002093744082e-7 &
      +t*(-2.02878733208210684e-8 &
      +t*1.11972866705178940e-9 &
      )))))))))/(0.672666709110930353e0 &
      +t*(4.51114986457223474e0 &
      +t*(14.2130577502093159e0 &
      +t*(27.0924755033205922e0 &
      +t*(33.3161322251216687e0 &
      +t*(25.3582658290231325e0 &
      +t*(8.61719049364763904e0 &
      +t*(-2.98613950390747585e0 &
      +t*(-3.72974082078125757e0 &
      -t)))))))))
    else
      w = 1.0 / (xx * xx)
      s = 1 - 1600 * w
      fd=factor/(sqrt(xx)*xx*xx*xx)*(1.e0 &
      +w*(20360.4093941608469e0 &
      +s*(48690.0157659639679e0 &
      +s*(56148.8553220593957e0 &
      +s*(16506.5714937251887e0 &
      +s*(1066.30280063583769e0 &
      +s*3.73715435019239458e0 &
      )))))/(765.319028032818290e0 &
      +s*(1851.12566867527470e0 &
      +s*(2160.21729234460541e0 &
      +s*(677.261952266814024e0 &
      +s*(56.0179124057448609e0 &
      +s))))))
    endif
    dfdm9h = fd%im / h
    return
  end function

  subroutine ifd1h(F, eta, detadF)
    !! inverse of fermi-dirac integral for j = 1/2 and derivative
    !! Reference: Fukushima, T. (2015, App. Math. Comp., 259, 698-707)
    real, intent(in)  :: F
      !! fermi-dirac integral value (> 0, without gamma prefactor)
    real, intent(out) :: eta
      !! output argument of fermi-dirac integral
    real, intent(out) :: detadF
      !! output derivative of eta wrt F

    real, parameter :: C1(10) = [ &
      8.4973821066601840E-01, 1.5637783330562941E+05, 4.8177570589828698E+04, 5.8470721838381196E+03, 3.3539780796721942E+02, &
      7.8441186802991201E+00, 1.1776202905535090E+05,-1.9007269383703679E+04, 1.3762936928453139E+03,-5.4113726984817170E+01 ]
    real, parameter :: C2(17) = [ &
      3.7691787449019803E-01,-4.4356940732931460E-01, 4.8914044731041020E+02, 5.3350726931726194E+03, 2.0169073614044250E+04, &
      3.5247811559551090E+04, 3.0462366861471477E+04, 1.2567903242612896E+04, 2.1318678935739867E+03, 9.3652017208541949E+01, &
      6.5682620764306057E+02, 4.2748283105194159E+03, 1.0555758131015149E+04, 1.2341874209461188E+04, 6.9491885441319710E+03, &
      1.6921965063419400E+03, 1.2922177299158975E+02 ]
    real, parameter :: C3(17) = [ &
      1.0465156933592495E-01,-4.0080827720541695E-01, 1.0198488640664235E+03, 9.4401825500392206E+03, 3.3947661636376244E+04, &
      6.0256728098054278E+04, 5.5243004506305580E+04, 2.4769835480221085E+04, 4.5117728861766827E+03, 2.1143280633615015E+02, &
      3.5050207035358642E+02, 2.5310629620123404E+03, 6.9390985065943923E+03, 9.0054019797239653E+03, 5.6067361299413406E+03, &
      1.4887663456400508E+03, 1.2153702888941258E+02 ]
    real, parameter :: C4(17) = [ &
      2.5090716445082574E-02,-3.3585051328246379E-01, 1.1885877939839949E+04, 1.1322025082517879E+05, 4.0852437388119783E+05, &
      6.9567435748347593E+05, 5.6938991708850558E+05, 2.0643308201368144E+05, 2.7307253567197411E+04, 8.2443082679473071E+02, &
      1.6344049122086119E+03, 1.2218115855188402E+04, 3.2911786995779323E+04, 3.8934696303939934E+04, 2.0038835843822581E+04, &
      3.9494838089779696E+03, 2.1560740489099570E+02 ]
    real, parameter :: C5(17) = [ &
      7.3980341563880635E-03,-3.9387746247592931E-01, 1.1730701119043564E+04, 9.9421745579663359E+04, 3.2770696891070693E+05, &
      5.3042566801656317E+05, 4.3863190051655506E+05, 1.7532285566231585E+05, 2.8701960598881389E+04, 1.2582091446428640E+03, &
      6.3408047038302618E+02, 4.2956315986026584E+03, 1.0868526066891194E+04, 1.2781687199797707E+04, 7.0938073210076054E+03, &
      1.6750641705630003E+03, 1.2575090181775967E+02 ]
    real, parameter :: C6( 7) = [ &
      1.0801341205098402E+03, 1.1281349514482193E+07, 4.2036891115716088E+05, 1.6896947571453611E+03, 6.0880835083129587E+03, &
      2.2144523675946675E+02, 7.1821670869539778E-01 ]
    real, parameter :: FBND( 5) = [ &
      1.3279138832783541E+00, 4.3216142181900556E+00, 1.5103862150597896E+01, 6.0075840912753129E+01, 2.1260003088573106E+02 ]

    real :: b, b1, n, n1, d, d1, s, s1, t

    if (F < FBND(1)) then
      t      = C1(1) * F
      n      =       t*(C1(2)+t*(C1(3)+t*(C1( 4)+t*(C1(5)+t*C1(6)))))
      d      = C1(7)+t*(C1(8)+t*(C1(9)+t*(C1(10)+t                )))
      b      = n / d
      eta    = log(b)
      n1     = (C1(2)+t*(2*C1(3)+t*(3*C1( 4)+t*(4*C1(5)+t*5*C1(6))))) * C1(1)
      d1     = (C1(8)+t*(2*C1(9)+t*(3*C1(10)+t* 4                 ))) * C1(1)
      b1     = (n1 - n * d1 / d) / d
      detadF = b1 / b
    elseif (F < FBND(2)) then
      t      = C2(1) * F + C2(2)
      n      = (C2( 3)+t*(C2( 4)+t*(C2( 5)+t*(C2( 6)+t*(C2( 7)+t*(C2( 8)+t*(C2( 9)+t*C2(10))))))))
      d      = (C2(11)+t*(C2(12)+t*(C2(13)+t*(C2(14)+t*(C2(15)+t*(C2(16)+t*(C2(17)+t       )))))))
      eta    = n / d
      n1     = (C2( 4)+t*(2*C2( 5)+t*(3*C2( 6)+t*(4*C2( 7)+t*(5*C2( 8)+t*(6*C2( 9)+t*7*C2(10))))))) * C2(1)
      d1     = (C2(12)+t*(2*C2(13)+t*(3*C2(14)+t*(4*C2(15)+t*(5*C2(16)+t*(6*C2(17)+t*7       )))))) * C2(1)
      detadF = (n1 - n * d1 / d) / d
    elseif (F < FBND(3)) then
      t      = C3(1) * F + C3(2)
      n      = C3( 3)+t*(C3( 4)+t*(C3( 5)+t*(C3( 6)+t*(C3( 7)+t*(C3( 8)+t*(C3( 9)+t*C3(10)))))))
      d      = C3(11)+t*(C3(12)+t*(C3(13)+t*(C3(14)+t*(C3(15)+t*(C3(16)+t*(C3(17)+t       ))))))
      eta    = n / d
      n1     = (C3( 4)+t*(2*C3( 5)+t*(3*C3( 6)+t*(4*C3( 7)+t*(5*C3( 8)+t*(6*C3( 9)+t*7*C3(10))))))) * C3(1)
      d1     = (C3(12)+t*(2*C3(13)+t*(3*C3(14)+t*(4*C3(15)+t*(5*C3(16)+t*(6*C3(17)+t*7       )))))) * C3(1)
      detadF = (n1 - n * d1 / d) / d
    elseif (F < FBND(4)) then
      t      = C4(1) * F + C4(2)
      n      = C4( 3)+t*(C4( 4)+t*(C4( 5)+t*(C4( 6)+t*(C4( 7)+t*(C4( 8)+t*(C4( 9)+t*C4(10)))))))
      d      = C4(11)+t*(C4(12)+t*(C4(13)+t*(C4(14)+t*(C4(15)+t*(C4(16)+t*(C4(17)+t       ))))))
      eta    = n / d
      n1     = (C4( 4)+t*(2*C4( 5)+t*(3*C4( 6)+t*(4*C4( 7)+t*(5*C4( 8)+t*(6*C4( 9)+t*7*C4(10))))))) * C4(1)
      d1     = (C4(12)+t*(2*C4(13)+t*(3*C4(14)+t*(4*C4(15)+t*(5*C4(16)+t*(6*C4(17)+t*7       )))))) * C4(1)
      detadF = (n1 - n * d1 / d) / d
    elseif (F < FBND(5)) then
      t      = C5(1) * F + C5(2)
      n      = C5( 3)+t*(C5( 4)+t*(C5( 5)+t*(C5( 6)+t*(C5( 7)+t*(C5( 8)+t*(C5( 9)+t*C5(10)))))))
      d      = C5(11)+t*(C5(12)+t*(C5(13)+t*(C5(14)+t*(C5(15)+t*(C5(16)+t*(C5(17)+t       ))))))
      eta    = n / d
      n1     = (C5( 4)+t*(2*C5( 5)+t*(3*C5( 6)+t*(4*C5( 7)+t*(5*C5( 8)+t*(6*C5( 9)+t*7*C5(10))))))) * C5(1)
      d1     = (C5(12)+t*(2*C5(13)+t*(3*C5(14)+t*(4*C5(15)+t*(5*C5(16)+t*(6*C5(17)+t*7       )))))) * C5(1)
      detadF = (n1 - n * d1 / d) / d
    else
      s      = C6(1) * F**(- 4.0/3.0)
      t      = 1 - s
      n      = C6(2)+t*(C6(3)+t*(C6(4)+t))
      d      = s*(C6(5)+t*(C6(6)+t*C6(7)))
      b      = n / d
      eta    = sqrt(b)
      s1     = C6(1) * (-4.0/3.0) * F**(-7.0/3.0)
      n1     = - (C6(3)+t*(2*C6(4)+t*3)) * s1
      d1     = s1*(C6(5)+t*(C6(6)+t*C6(7)) - s*(C6(6)+t*2*C6(7)))
      b1     = (n1 - n * d1 / d) / d
      detadF = 0.5 / sqrt(b) * b1
    end if
  end subroutine

end module
