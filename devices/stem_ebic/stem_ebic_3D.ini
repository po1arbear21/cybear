! STEM-EBIC 3D Device Configuration
! Based on stem_ebic.ini geometry extended to 3D
!
!   Geometry:
!     x = 500 nm    (lamella thickness - beam penetrates through this)
!     y = 9 μm      (device height: 8.5 μm Si + 0.5 μm SiO2)
!     z = 14 μm     (device width)
!
!   Structure (y-z cross-section at any x):
!
!   y=9.0μm  ┌─────────────────────────────────────────┐
!            │              SiO2 (0.5 μm)              │
!   y=8.5μm  ├─────────────────────────────────────────┤ ← P_CONTACT (z=14μm, y=8.0-8.5μm)
!            │              p-region                   │
!   y=7.0μm  │─ ─ ─ ─ ─ ─ ─ junction ─ ─ ─ ─ ─ ─ ─ ─   │
!            │              n-region                   │
!   y=0      └─────────────────────────────────────────┘
!           z=0                                      z=14μm
!            ↑
!         N_CONTACT (z=0, y=0-1.5μm)
!
!   Beam: penetrates through x at position (y_sweep, z_center)
!         sweeps along y, z fixed at device center

$py(
# Device geometry
thickness = 500.0    # nm (x-direction, beam path)
height    = 9.0      # um (y-direction, including oxide)
width     = 14.0     # um (z-direction)
si_height = 8.5      # um (silicon only, y-direction)
junction  = 7.0      # um (y-position of p-n junction)

# Grid spacing (coarse for initial testing)
max_dx = 50.0        # nm
max_dy = 200.0       # nm
max_dz = 200.0       # nm
)


[transport parameters]
  electrons  = true
  holes      = true
  N_c0       = 6.24672e15 : 1/cm^3
  N_v0       = 3.5e15     : 1/cm^3
  E_gap      = 1.12       : eV
  dos        = "parabolic"
  dist       = "maxwell"
  tabledir   = "tables/"
  stab       = "SG"
  reg_A      = 1e-12
  reg_B      = 0.001
  mob        = false
  alpha      =   0.77,   0.70
  beta       =    2.0,    1.0
  mob_min    =   74.5,  122.3 : cm^2/V/s
  mob_max    = 1430.0,  480.0 : cm^2/V/s
  N_ref      = 8.6e16, 1.4e17 : 1/cm^3
  v_sat      =    1e10,  1e10 : cm/s
  curr_fact  = 1.0               ! Dimensionless for 3D (no per-unit-depth scaling)
  incomp_ion = false
  ii_tau     = 1.0, 1.0 : ps
  ii_E_dop0  = 45.5, 44.39 : meV
  ii_g       = 2.0, 4.0
  ii_N_crit  = 2e19, 2e19 : 1/cm^3
  ii_dop_th  = 1e25, 1e25 : 1/cm^3

  srh        = true           ! Enable bulk SRH recombination
  srh_tau_n  = 1e-10 : s      ! Electron lifetime
  srh_tau_p  = 1e-10 : s      ! Hole lifetime

  ! Surface physics disabled for 3D (not yet implemented)
  surf_recom   = false
  charged_surf = false


[grid]
  gtype  = "xyz"
  max_dx = $(max_dx) : nm
  max_dy = $(max_dy) : nm
  max_dz = $(max_dz) : nm

! SiO2 oxide on top (0.5 μm thick, y = 8.5-9.0 μm)
[poisson]
  x   = 0.0, $(thickness) : nm
  y   = $(si_height), $(height) : um
  z   = 0.0, $(width) : um
  eps = 3.9 : eps0

! Silicon region (y = 0 to 8.5 μm)
[poisson]
  x   = 0.0, $(thickness) : nm
  y   = 0.0, $(si_height) : um
  z   = 0.0, $(width) : um
  eps = 11.7 : eps0

! Transport region (entire Si)
[transport]
  x = 0.0, $(thickness) : nm
  y = 0.0, $(si_height) : um
  z = 0.0, $(width) : um

! p-type doping (above junction, y = 7.0 to 8.5 μm)
[doping]
  x    = 0.0, $(thickness) : nm
  y    = $(junction), $(si_height) : um
  z    = 0.0, $(width) : um
  acon = 1e18 : 1/cm^3

! n-type doping (below junction, y = 0 to 7.0 μm)
[doping]
  x    = 0.0, $(thickness) : nm
  y    = 0.0, $(junction) : um
  z    = 0.0, $(width) : um
  dcon = 1e18 : 1/cm^3

! Ohmic contact on p-side (z = 14 μm edge, y = 8.0 to 8.5 μm)
[contact]
  name = "P_CONTACT"
  type = "ohmic"
  x    = 0.0, $(thickness) : nm
  y    = 8.0, $(si_height) : um
  z    = $(width), $(width) : um

! Ohmic contact on n-side (z = 0 edge, y = 0 to 1.5 μm)
[contact]
  name = "N_CONTACT"
  type = "ohmic"
  x    = 0.0, $(thickness) : nm
  y    = 0.0, 1.5 : um
  z    = 0.0, 0.0 : um

! STEM-EBIC beam configuration
! Beam penetrates through x (lamella thickness) at position (y, z_center)
! Sweeps along y with z fixed at device center
[beam]
  beam_min  = 0.0 : um              ! Sweep minimum (y)
  beam_max  = $(si_height) : um     ! Sweep maximum (y, full Si height)
  I_beam    = 0.0825 : nA              ! Actual beam current (3D: no per-unit-depth)
  lamella_t = $(thickness) : nm     ! Lamella thickness (beam path = x-extent)
  beam_dist = "line"                ! Line profile for 3D (beam along x at (y,z))
  Y_BEAM    = 0, 5.5, 8.0, 8.5 : um  ! Beam sweep positions (grid nodes)
  N_BEAM    = 11, 26, 6

! Refine around the p-n junction (y = 7.0 um)
! Note: 3D grids are tensor products, so refinement multiplies across all dimensions.
! Use coarser refinement than 2D to keep mesh tractable.
[refine grid]
  y  = 6.5, 7.0 : um
  dy = 50.0, 20.0 : nm   ! coarse to fine approaching junction
  e  = 1.0

[refine grid]
  y  = 7.0, 7.5 : um
  dy = 20.0, 50.0 : nm   ! fine to coarse leaving junction
  e  = 1.0
