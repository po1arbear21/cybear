$py(
# ============================================================================
# Vertical Perovskite FET - A07 Project (TRR404 C02 + A07)
# ============================================================================
# Half-aperture geometry with symmetry at x=0
#
# Device structure (cross-section):
#   DRAIN (Ohmic) at top
#   |  PEROVSKITE  |
#   +--SOURCE--+   | (Schottky: sidewall + top)
#      OXIDE       |
#      GATE        |
#
# Coordinate system:
#   x = 0: symmetry plane (center of aperture)
#   y = 0: oxide-perovskite interface
#   y < 0: gate oxide
#   y > 0: perovskite active layer
# ============================================================================

# === Geometry Parameters (nm) ===
W_ap_half = 5000      # Half aperture width (symmetry at x=0)
W_src = 5000          # Source finger width
L_domain = W_ap_half + W_src  # Total x-domain = 10 um

t_ox = 90             # Gate oxide thickness
t_source = 17         # Source metal thickness (7 or 17 nm variants)
t_perov = 500         # Perovskite thickness (= channel length)

# === Derived coordinates ===
y_gate = -t_ox        # Bottom of oxide (gate electrode)
y_ox_top = 0          # Top of oxide / bottom of perovskite
y_src_top = t_source  # Top of source metal
y_drain = t_perov     # Top of perovskite (drain electrode)

x_src_edge = W_ap_half  # Source sidewall position

# === Material Parameters ===
# Perovskite (MAPbI3-type)
eps_perov = 25        # Relative permittivity (high for perovskites)
E_gap_perov = 1.6     # Bandgap (eV)
N_v_perov = 1e18      # Valence band effective DOS (1/cm^3)
mu_p_perov = 5        # Hole mobility (cm^2/Vs) - placeholder, update with measured value
N_a_perov = 1e15      # Light p-type doping (1/cm^3)

# Oxide (SiO2)
eps_ox = 3.9          # Relative permittivity

# Schottky contact (Au/perovskite)
phi_b_Au = 0.4        # Schottky barrier height for holes (eV) - estimate
A_rich_p = 32         # Richardson constant for holes (A/cm^2/K^2)

# === Mesh Parameters ===
dx_fine = 5           # Fine mesh spacing (nm)
dy_fine = 2           # Fine mesh spacing (nm)
dx_coarse = 50        # Coarse mesh spacing (nm)
dy_coarse = 20        # Coarse mesh spacing (nm)
)

# ============================================================================
# TRANSPORT PARAMETERS (Perovskite - p-type unipolar)
# ============================================================================
[transport parameters]
  electrons  = false
  holes      = true
  N_c0       = 1e18           : 1/cm^3
  N_v0       = $(N_v_perov)   : 1/cm^3
  E_gap      = $(E_gap_perov) : eV
  dos        = "parabolic"
  dist       = "maxwell"
  reg_A      = 1e-12
  reg_B      = 0.001
  mob        = false
  curr_fact  = 1.0 : um

# ============================================================================
# GRID CONFIGURATION
# ============================================================================
[grid]
  gtype  = "xy"
  max_dx = $(dx_coarse) : nm
  max_dy = $(dy_coarse) : nm

# ============================================================================
# POISSON REGIONS (Electrostatics)
# ============================================================================
# Gate oxide region (no transport here)
[poisson]
  name = "oxide"
  x    = 0, $(L_domain)  : nm
  y    = $(y_gate), $(y_ox_top) : nm
  eps  = $(eps_ox)       : eps0

# Perovskite region (full domain above oxide)
[poisson]
  name = "perovskite"
  x    = 0, $(L_domain)  : nm
  y    = $(y_ox_top), $(y_drain) : nm
  eps  = $(eps_perov)    : eps0

# ============================================================================
# TRANSPORT REGIONS (Drift-Diffusion)
# ============================================================================
# Full perovskite region (carriers only in semiconductor)
[transport]
  x = 0, $(L_domain) : nm
  y = $(y_ox_top), $(y_drain) : nm

# ============================================================================
# DOPING
# ============================================================================
# Light p-type background in perovskite
[doping]
  x    = 0, $(L_domain)  : nm
  y    = $(y_ox_top), $(y_drain) : nm
  acon = $(N_a_perov)    : 1/cm^3

# ============================================================================
# MOBILITY
# ============================================================================
[mobility]
  x     = 0, $(L_domain)  : nm
  y     = $(y_ox_top), $(y_drain) : nm
  mob_p = $(mu_p_perov)   : cm^2/V/s

# ============================================================================
# CONTACTS
# ============================================================================
# GATE: Bottom of oxide (capacitive coupling)
[contact]
  name  = "GAT"
  type  = "gate"
  phims = 0.0            : V
  x     = 0, $(L_domain) : nm
  y     = $(y_gate), $(y_gate) : nm

# SOURCE: Sidewall (Schottky injection into aperture)
[contact]
  name           = "SRC"
  type           = "schottky"
  phi_b          = $(phi_b_Au)    : eV
  A_richardson_p = $(A_rich_p)    : A/cm^2/K^2
  ifbl           = true
  x              = $(x_src_edge), $(x_src_edge) : nm
  y              = $(y_ox_top), $(y_src_top)    : nm

# SOURCE: Top surface (Schottky injection from above source metal)
[contact]
  name           = "SRC"
  type           = "schottky"
  phi_b          = $(phi_b_Au)    : eV
  A_richardson_p = $(A_rich_p)    : A/cm^2/K^2
  ifbl           = true
  x              = $(x_src_edge), $(L_domain) : nm
  y              = $(y_src_top), $(y_src_top) : nm

# DRAIN: Top of perovskite (Ohmic)
[contact]
  name  = "DRN"
  type  = "ohmic"
  phims = 0.0            : V
  x     = 0, $(L_domain) : nm
  y     = $(y_drain), $(y_drain) : nm

# ============================================================================
# MESH REFINEMENT
# ============================================================================
# Fine mesh near source sidewall (x-direction)
[refine grid]
  dir = 1
  x   = $(x_src_edge - 20), $(x_src_edge + 20) : nm
  dx  = $(dx_fine), $(dx_fine) : nm
  e   = 1.0

# Fine mesh near source top (y-direction)
[refine grid]
  dir = 2
  x   = $(y_src_top - 10), $(y_src_top + 15) : nm
  dx  = $(dy_fine), $(dy_fine) : nm
  e   = 1.0

# Fine mesh at oxide-perovskite interface (y-direction)
[refine grid]
  dir = 2
  x   = $(y_ox_top - 5), $(y_ox_top + 10) : nm
  dx  = 1, 3 : nm
  e   = 1.5

# Coarse mesh in bulk perovskite (y-direction)
[refine grid]
  dir = 2
  x   = 50, 450 : nm
  dx  = $(dy_coarse), $(dy_coarse) : nm
  e   = 1.0
